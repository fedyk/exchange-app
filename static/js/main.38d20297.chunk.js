(this.webpackJsonpundefined=this.webpackJsonpundefined||[]).push([[0],{23:function(t,n,e){},25:function(t,n,e){},26:function(t,n,e){},27:function(t,n,e){},28:function(t,n,e){},29:function(t,n,e){},30:function(t,n,e){"use strict";e.r(n);var c=e(1),r=e.n(c),a=e(6),o=e.n(a),s=e(2),i=e(3),u=e(9),h=e(8),l=e(7),d=function(){return fetch.apply(void 0,arguments)},f=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;Object(s.a)(this,t),this.httpProvider=void 0,this.httpProvider=n}return Object(i.a)(t,[{key:"fetchRates",value:function(t){var n=this;return this.httpProvider("https://openexchangerates.org/api/latest.json?app_id=487ba03c696b415ab481a430e1f731bc&symbols=EUR,GBP",{signal:t}).then((function(t){return n.parseResponse(t)}))}},{key:"parseResponse",value:function(t){var n=this;if(t.ok)return t.json().then((function(t){return n.parseFx(t)}));throw new Error("Fail to retrieve FX information: ".concat(t.statusText," (").concat(t.status,")"))}},{key:"parseFx",value:function(t){var n;return{base:String(null!==(n=null===t||void 0===t?void 0:t.base)&&void 0!==n?n:""),rates:t.rates||{}}}}]),t}(),p="SET_RATES",m="SET_RATES_STATUS";function v(t){return{type:m,payload:t}}var b="SET_ACCOUNTS",j="UPDATE_ACCOUNT";function y(t,n){return{type:j,payload:{account:n,accountId:t}}}var x=e(4),g=[];var O,N=e(5);!function(t){t[t.Unknown=0]="Unknown",t[t.Syncing=1]="Syncing",t[t.UpToDate=2]="UpToDate",t[t.OutToDate=3]="OutToDate"}(O||(O={}));var A={rates:null,status:O.Unknown};var S="ADD_TRANSACTION",w=[];var k=x.b({rates:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case p:return Object(N.a)(Object(N.a)({},t),{},{rates:n.payload});case m:return Object(N.a)(Object(N.a)({},t),{},{status:n.payload});default:return t}},accounts:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case b:return n.payload;case j:return t.map((function(t){return t.id===n.payload.accountId?Object.assign({},t,n.payload.account):t}));default:return t}},transactions:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case S:return[n.payload].concat(t);default:return t}}});var C=function(){function t(n,e){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4;Object(s.a)(this,t),this.api=void 0,this.store=void 0,this.timer=void 0,this.abort=void 0,this.syncInterval=void 0,this.api=n,this.store=e,this.syncInterval=c}return Object(i.a)(t,[{key:"stopSync",value:function(){var t;null===(t=this.abort)||void 0===t||t.abort(),clearTimeout(this.timer)}},{key:"startSync",value:function(){var t=this;return this.store.dispatch(v(O.Syncing)),this.abort&&this.abort.abort(),this.abort=new AbortController,this.api.fetchRates(this.abort.signal).then((function(n){t.store.dispatch(function(t){return{type:p,payload:t}}(n)),t.store.dispatch(v(O.UpToDate))})).catch((function(n){t.store.dispatch(v(O.OutToDate))})).finally((function(){t.scheduleSync()}))}},{key:"scheduleSync",value:function(){var t=this;this.timer=setTimeout((function(){return t.startSync()}),this.syncInterval)}}]),t}(),I=[{id:1,currency:"USD",currencySign:"$",balance:204554,precision:2},{id:2,currency:"EUR",currencySign:"\u20ac",balance:25e3,precision:2},{id:3,currency:"GBP",currencySign:"\xa3",balance:5833,precision:2}],T={base:"USD",rates:{EUR:.842857,GBP:.722836}};function E(t,n,e){var c=Math.pow(10,n);return"".concat(e).concat(t/c)}function R(t){return 0===t.length||(!!/^\d+$/.test(t)||(!(!t.includes(".")||!/^\d+\.\d*$/.test(t))||!(!t.includes(",")||!/^\d+,\d*$/.test(t))))}function D(t,n){var e=Number(t.replace(",","."));if(Number.isNaN(e))return e;var c=Math.pow(10,n);return Math.floor(e*c)}function U(t){return{type:S,payload:t}}e(23);var M=e(0);function F(t){return Object(M.jsxs)("div",{className:"dynamic-input",children:[Object(M.jsx)("span",{className:"dynamic-input-space-keeper",children:t.value}),Object(M.jsx)("input",{type:"text",className:"dynamic-input-control",name:t.name,value:t.value,onKeyDown:function(n){"Enter"===n.key&&"function"===typeof t.onEnterKeyDown&&t.onEnterKeyDown()},onChange:function(n){"function"===typeof t.onChange&&t.onChange(n.target.value)},maxLength:10,ref:t.inputRef,autoFocus:t.autoFocus,"aria-label":t.name})]})}e(25);function P(t){return Object(M.jsx)("div",{className:"tabs",children:t.items.map((function(n,e){var c="tab ".concat(e===t.selectedIndex?"active":"");return Object(M.jsx)("button",{className:c,onClick:function(){return t.onSelect(e)},"data-role":"tab-item",children:n},e)}))})}var _=0;e(26);function B(t){var n=new Intl.DateTimeFormat("en-US",{dateStyle:"short",timeStyle:"short"});return 0===t.transactions.length?Object(M.jsx)("div",{className:"transactions-empty-state",children:"Your upcoming transfers will appear here"}):Object(M.jsx)("div",{className:"transactions",children:t.transactions.map((function(t){return Object(M.jsxs)("div",{className:"transaction",children:[Object(M.jsxs)("div",{className:"transaction-row",children:[Object(M.jsx)("div",{className:"transaction-primary-cell",children:"Exchanged ".concat(E(t.from,t.fromPrecision,t.fromCurrencySign)," to ").concat(E(t.to,t.toPrecision,t.toCurrencySign))}),Object(M.jsxs)("div",{className:"transaction-primary-cell accent",children:["+",E(t.from,t.fromPrecision,t.fromCurrencySign)]})]}),Object(M.jsxs)("div",{className:"transaction-row",children:[Object(M.jsx)("div",{className:"transaction-secondary-cell",children:n.format(t.createdAt)}),Object(M.jsxs)("div",{className:"transaction-secondary-cell",children:["-",E(t.to,t.toPrecision,t.toCurrencySign)]})]})]},t.id)}))})}function K(t){return Object(M.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon",viewBox:"0 0 512 512",width:t.width||512,height:t.height||512,children:[Object(M.jsx)("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M434.67 285.59v-29.8c0-98.73-80.24-178.79-179.2-178.79a179 179 0 00-140.14 67.36m-38.53 82v29.8C76.8 355 157 435 256 435a180.45 180.45 0 00140-66.92"}),Object(M.jsx)("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M32 256l44-44 46 44m358 0l-44 44-46-44"})]})}e(27);var L=function(t){Object(u.a)(e,t);var n=Object(h.a)(e);function e(t){var c;return Object(s.a)(this,e),(c=n.call(this,t)).fromInputRef=void 0,c.toInputRef=void 0,c.handleFromChange=function(t){R(t)&&c.setState({from:t,to:""})},c.handleToChange=function(t){R(t)&&c.setState({to:t,from:""})},c.handleExchange=function(){var t=c.fromAccount,n=c.toAccount;if(t&&n&&c.props.rates&&!c.isExchangeDisabled){var e=D(c.from,t.precision),r=D(c.to,n.precision);Number.isNaN(e)||Number.isNaN(r)||(c.props.onAddTransaction(function(t,n,e,c){return{id:++_,from:t,fromPrecision:e.precision,fromCurrency:e.currency,fromCurrencySign:e.currencySign,to:n,toPrecision:c.precision,toCurrency:c.currency,toCurrencySign:c.currencySign,createdAt:Date.now()}}(e,r,t,n)),c.props.onUpdateAccount(t.id,{balance:t.balance-e}),c.props.onUpdateAccount(n.id,{balance:n.balance+r}),c.setState({from:"",to:""}))}},c.state={to:"",from:"",fromAccountIndex:0,toAccountIndex:1},c.fromInputRef=r.a.createRef(),c.toInputRef=r.a.createRef(),c}return Object(i.a)(e,[{key:"handleFromAccountChange",value:function(t){var n=this.state.toAccountIndex;n===t&&(n=this.state.fromAccountIndex),this.setState({fromAccountIndex:t,toAccountIndex:n})}},{key:"handleToAccountChange",value:function(t){var n=this.state.fromAccountIndex;n===t&&(n=this.state.toAccountIndex),this.setState({toAccountIndex:t,fromAccountIndex:n})}},{key:"rates",get:function(){var t=this.fromAccount,n=this.toAccount;return t&&n&&this.props.rates?function(t,n,e){var c=Object.assign({},e.rates);if(c[e.base]=1,!c[t]||!c[n])throw new Error("Missed FX rates");return t===e.base?c[n]:n===e.base?1/c[t]:c[n]*(1/c[t])}(t.currency,n.currency,this.props.rates):NaN}},{key:"from",get:function(){var t=this.fromAccount,n=this.toAccount,e=this.rates;if(this.state.to&&t&&n&&!Number.isNaN(e)){var c=D(this.state.to,n.precision),r=Math.pow(10,t.precision);if(!Number.isNaN(c))return"".concat(Math.floor(c/e)/r)}return this.state.from}},{key:"to",get:function(){var t=this.fromAccount,n=this.toAccount,e=this.rates;if(this.state.from&&t&&n&&!Number.isNaN(e)){var c=D(this.state.from,t.precision),r=Math.pow(10,n.precision);if(!Number.isNaN(c))return"".concat(Math.floor(c*e)/r)}return this.state.to}},{key:"isExchangeDisabled",get:function(){var t=this.fromAccount,n=this.toAccount;if(!t||!n||!this.props.rates)return!0;var e=D(this.from,t.precision);return!(!Number.isNaN(e)&&0!==e)||t.balance<e}},{key:"fromAccount",get:function(){return this.props.accounts[this.state.fromAccountIndex]}},{key:"toAccount",get:function(){return this.props.accounts[this.state.toAccountIndex]}},{key:"render",value:function(){var t=this,n=this.props.accounts.map((function(t){return t.currency}));return Object(M.jsxs)("div",{className:"container",children:[Object(M.jsxs)("div",{className:"widget",children:[Object(M.jsxs)("div",{className:"account",children:[Object(M.jsxs)("div",{className:"account-header","data-testid":"from-account",children:[Object(M.jsx)("div",{className:"account-title",children:"Exchange"}),Object(M.jsx)(P,{items:n,selectedIndex:this.state.fromAccountIndex,onSelect:function(n){return t.handleFromAccountChange(n)}})]}),Object(M.jsxs)("div",{className:"input-box",onClick:function(){var n;return null===(n=t.fromInputRef.current)||void 0===n?void 0:n.focus()},children:[Object(M.jsxs)("div",{className:"input-box-body",children:[this.from&&Object(M.jsx)("span",{className:"exchange-direction",children:"-"}),Object(M.jsx)(F,{name:"from-input",value:this.from,onChange:this.handleFromChange,onEnterKeyDown:this.handleExchange,inputRef:this.fromInputRef,autoFocus:!0})]}),Object(M.jsx)("div",{className:"input-box-footer",children:Object(M.jsx)("div",{className:"hint",children:this.fromAccount?"You have ".concat(E(this.fromAccount.balance,this.fromAccount.precision,this.fromAccount.currencySign)):""})})]})]}),Object(M.jsxs)("div",{className:"account","data-testid":"to-account",children:[Object(M.jsx)(P,{items:n,selectedIndex:this.state.toAccountIndex,onSelect:function(n){return t.handleToAccountChange(n)}}),Object(M.jsxs)("div",{className:"input-box",onClick:function(){var n;return null===(n=t.toInputRef.current)||void 0===n?void 0:n.focus()},children:[Object(M.jsxs)("div",{className:"input-box-body",children:[this.to&&Object(M.jsx)("span",{className:"exchange-direction",children:"+"}),Object(M.jsx)(F,{name:"to-input",value:this.to,onChange:this.handleToChange,onEnterKeyDown:this.handleExchange,inputRef:this.toInputRef})]}),Object(M.jsxs)("div",{className:"input-box-footer",children:[Object(M.jsx)("div",{className:"hint",children:this.toAccount?"You have ".concat(E(this.toAccount.balance,this.toAccount.precision,this.toAccount.currencySign)):""}),Object(M.jsx)("div",{className:"hint",children:this.renderRate()})]})]})]}),Object(M.jsx)("div",{className:"widget-footer",children:Object(M.jsx)("button",{className:"primary-btn",disabled:this.isExchangeDisabled,onClick:this.handleExchange,"aria-label":"exchange-button",children:"Exchange"})})]}),Object(M.jsx)(B,{transactions:this.props.transactions})]})}},{key:"renderRate",value:function(){var t=this.fromAccount,n=this.toAccount,e=this.rates;if(!t||!n||Number.isNaN(e))return null;var c=E(1*Math.pow(10,t.precision),t.precision,t.currencySign),r=E(1*Math.floor(Math.pow(10,n.precision)*e),n.precision,n.currencySign);return Object(M.jsxs)("span",{className:"current-rates",children:[this.props.status===O.Syncing&&Object(M.jsx)("span",{title:"Update exchange rates",className:"current-rates-icon",children:Object(M.jsx)(K,{width:16,height:16})}),Object(M.jsx)("span",{children:"".concat(c," = ").concat(r)})]})}}]),e}(r.a.Component);var $=Object(l.b)((function(t){return{rates:t.rates.rates,status:t.rates.status,accounts:t.accounts,transactions:t.transactions}}),(function(t){return{onAddTransaction:Object(x.a)(U,t),onUpdateAccount:Object(x.a)(y,t)}}))(L),G=(e(28),function(t){Object(u.a)(e,t);var n=Object(h.a)(e);function e(t){var c,r;return Object(s.a)(this,e),(c=n.call(this,t)).api=void 0,c.store=void 0,c.ratesSync=void 0,c.api=new f,c.store=(r={accounts:I,rates:{rates:T,status:O.Unknown}},x.c(k,r)),c.ratesSync=new C(c.api,c.store),c}return Object(i.a)(e,[{key:"componentDidMount",value:function(){this.ratesSync.startSync()}},{key:"componentWillUnmount",value:function(){this.ratesSync.stopSync()}},{key:"render",value:function(){return Object(M.jsx)(l.a,{store:this.store,children:Object(M.jsx)($,{})})}}]),e}(r.a.Component));e(29);o.a.render(Object(M.jsx)(r.a.StrictMode,{children:Object(M.jsx)(G,{})}),document.getElementById("root"))}},[[30,1,2]]]);
//# sourceMappingURL=main.38d20297.chunk.js.map